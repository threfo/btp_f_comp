var ot=Object.defineProperty,nt=Object.defineProperties;var st=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var B=(o,t,e)=>t in o?ot(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,g=(o,t)=>{for(var e in t||(t={}))L.call(t,e)&&B(o,e,t[e]);if(w)for(var e of w(t))A.call(t,e)&&B(o,e,t[e]);return o},E=(o,t)=>nt(o,st(t));var N=(o,t)=>{var e={};for(var n in o)L.call(o,n)&&t.indexOf(n)<0&&(e[n]=o[n]);if(o!=null&&w)for(var n of w(o))t.indexOf(n)<0&&A.call(o,n)&&(e[n]=o[n]);return e};import{h as it,t as z,n as T,d as M,M as V,x as h,E as H,_ as R,y as rt}from"./plugin-vue_export-helper.18c10bfb.js";const lt=o=>o?Object.entries(o).reduce((t,[e,n])=>(e=e.charAt(0).toUpperCase()+e.slice(1),e=`on${e}`,E(g({},t),{[e]:n})),{}):null,f=(o,t={},e)=>{const d=t,{props:n,attrs:s,domProps:i,on:r}=d,l=N(d,["props","attrs","domProps","on"]),a=lt(r),c=g(g(g(g(g({},l),n),s),i),a);return it(o,c,e)},at=o=>typeof o=="function"?o():o,ct=(o,t="default")=>{const e=((o==null?void 0:o.slots)||{})[t];return at(e)||[]};class dt{constructor({caret:t,dropdownEle:e,scrollingEle:n,fixHeightGap:s=5}){this.fixHeightGap=5,this.fixHeightGap=s,this.initCaret(t),this.initClient(n),this.initDropdownSize(e)}initCaret(t){const{top:e,height:n}=t||{},{fixHeightGap:s}=this;this.caret=E(g({},t),{top:e-s,height:n+s+5})}initClient(t){const{caret:e}=this,{left:n,top:s}=e||{},{clientWidth:i,clientHeight:r}=t||{},l=s,a=i-n,c=r-l;this.client={clientWidth:i,clientHeight:r,toClientLeft:n,toClientTop:l,toClientRight:a,toClientBottom:c}}initDropdownSize(t){const{offsetHeight:e,offsetWidth:n}=t;this.dropdownSize={height:e,width:n}}get isBottom(){const{client:t,caret:e,dropdownSize:n}=this,{toClientBottom:s}=t;return s-e.height>=n.height}get isRight(){const{client:t,dropdownSize:e}=this,{toClientRight:n}=t;return n>=e.width}get isTop(){const{dropdownSize:t,client:e}=this,{toClientTop:n}=e;return n>=t.height}get isLeft(){const{dropdownSize:t,client:e}=this,{toClientLeft:n}=e;return n>=t.width}get isBottomRight(){return this.isBottom&&this.isRight}get isTopRight(){return this.isTop&&this.isRight}get isBottomLeft(){return this.isBottom&&this.isLeft}get isTopLeft(){return this.isTop&&this.isLeft}positionBottomRight(){const{client:t,caret:e}=this,{toClientTop:n,toClientLeft:s}=t;return{top:n+e.height,left:s}}positionTopRight(){const{dropdownSize:t,client:e}=this,{toClientTop:n,toClientLeft:s}=e;return{top:n-t.height,left:s}}positionBottomLeft(){const{dropdownSize:t,client:e,caret:n}=this,{toClientTop:s,toClientLeft:i}=e;return{top:s+n.height,left:i-t.width}}positionTopLeft(){const{dropdownSize:t,client:e}=this,{toClientTop:n,toClientLeft:s}=e;return{top:n-t.height,left:s-t.width}}positionOther(){const{dropdownSize:t,client:e}=this,{toClientTop:n,toClientLeft:s,toClientRight:i,toClientBottom:r,caret:l}=e,a=s>i?s-t.width:s;return{top:n>r?n-t.height:n+l.height,left:a}}get position(){return this.isBottomRight?this.positionBottomRight():this.isTopRight?this.positionTopRight():this.isBottomLeft?this.positionBottomLeft():this.isTopLeft?this.positionTopLeft():this.positionOther()}}const ut=({caret:o,dropdownEle:t,scrollingEle:e,fixHeightGap:n=5})=>new dt({caret:o,dropdownEle:t,scrollingEle:e,fixHeightGap:n}).position,pt=o=>{let t=null,e;const{getSelection:n}=o||{};if(n){e=o.getSelection();const{rangeCount:s}=e||{};s>0&&(t=e.getRangeAt(0))}return t},ft=o=>{var r;const t=(r=o==null?void 0:o.createRange())==null?void 0:r.duplicate();t==null||t.moveStart("character",-1);const e=t==null?void 0:t.getBoundingClientRect(),{bottom:n=0,top:s=0,left:i=0}=e||{};return{height:n-s,left:i,top:s}},ht=o=>{const t=o==null?void 0:o.cloneRange();t==null||t.setStart(o.endContainer,o.endOffset-1),t==null||t.setEnd(o.endContainer,o.endOffset);const e=t==null?void 0:t.getBoundingClientRect(),{height:n=0,top:s=0,left:i=0,width:r=0}=e||{},l={height:n,left:i+r,top:s};return t==null||t.detach(),l},gt=(o,t)=>{const e=o==null?void 0:o.cloneRange(),n=t==null?void 0:t.createTextNode("|");e==null||e.insertNode(n),e==null||e.selectNode(n);const s=e==null?void 0:e.getBoundingClientRect(),{height:i=0,left:r=0,top:l=0}=s||{},a={height:i,left:r,top:l};return n==null||n.remove(),e==null||e.detach(),a},vt=(o,t,e)=>{const{_initRange:n,_getDefOffset:s,_getHeight0Offset:i,_getOldIEOffset:r}=e||{_initRange:pt,_getDefOffset:ht,_getHeight0Offset:gt,_getOldIEOffset:ft};let l;const a=n(t),{document:c}=t||{},{selection:d}=c||{};if(a){a.endOffset-1>0&&a.endContainer!==o&&(l=s(a));const{height:p=0}=l||{};p===0&&(l=i(a,c))}else d&&(l=r(d));return l&&(l.top+=t.pageYOffset,l.left+=t.pageXOffset),l},y=(o,t)=>{const{refs:e}=o||{};return(e||{})[t]},m=({e:o,setupRef:t})=>{const{preventKeyUp:e}=t;o.preventDefault(),e.value=!0},I=o=>o.code==="ArrowDown",K=o=>o.code==="ArrowUp",yt=o=>o.code==="Enter",wt=o=>o.code==="Escape",mt=o=>{const{activeIndex:t,list:e}=o;t.value++,t.value===e.value.length&&(t.value=e.value.length-1)},bt=o=>{o.value--,o.value===-1&&(o.value=0)},St=({props:o,e:t})=>{const{watchSymbolsPolicy:e}=z(o||{});return e.value.find(s=>{const{watchInputEvent:i}=s||{};return i(t)})},_t=({str:o,props:t})=>{const{watchSymbolsPolicy:e}=z(t||{});return e.value.find(s=>{const{watchStr:i}=s||{};return i(o)})},Ct=o=>{const{range:t,selection:e}=o||{},{endContainer:n}=t||{},{nodeName:s,textContent:i}=n||{},{focusOffset:r}=e||{};let l=null;return s==="#text"&&i&&(l=i.slice(0,r)),l},P=o=>{let t=null,e=null,n=null;return o.getSelection&&(n=o.getSelection(),n.getRangeAt&&n.rangeCount&&(e=n.getRangeAt(0),t={range:e,selection:n})),t},k=(o,t)=>{const{label:e,symbol:n}=o||{},s=t.createElement("button");return s.dataset.value=JSON.stringify(o),s.textContent=`${n||"@"}${e||""}`,s.contentEditable=!1,s.addEventListener("click",()=>!1,!1),s.tabindex="-1",s},U=(o,t)=>t.createTextNode(o),xt=o=>o.createElement("br"),Dt=o=>U("\u200B",o),W=({data:o,that:t,doc:e,setupRef:n})=>{var a,c;const{isShowDropdown:s,editorRange:i,symbolsPolicy:r}=n;s.value=!1;const l=y(t,"editorEle");if(l){l.focus();const{range:d}=i.value||{};if(!d||!r.value)return;const{endContainer:p,endOffset:S}=d||{},{nodeValue:_}=p||{},{regExp:C}=r.value||{},v=C.exec(_);if(v&&v.length>1){d.setStart(p,v.index),d.setEnd(p,S),d.deleteContents();const x=k(o,e),D=Dt(e);i.value&&$({html:[x,D],selection:(a=i.value)==null?void 0:a.selection,range:(c=i.value)==null?void 0:c.range,that:t,doc:e,setupRef:n})}}},Et=o=>{let t=[];return o&&Array.from(o.childNodes).forEach(function(e){if(e.nodeName==="#text"){let n=e.nodeValue;n&&n.length>0&&n[n.length-1].charCodeAt(0)===8203&&(n=n.slice(0,-1)),n&&t.push({type:"text",data:n})}else e.nodeName==="BR"?t.push({type:"br",data:`
`}):e.nodeName==="BUTTON"?t.push({type:"symbol",data:JSON.parse(e.dataset.value)}):e.nodeName==="SPAN"&&t.push({type:"text",data:e.textContent})}),t=Tt(t),t},Tt=o=>{const t=[];return o.forEach(e=>{const n=t[t.length-1];n&&n.type&&n.type==="text"&&e.type==="text"?n.data=n.data+e.data:t.push(e)}),t},G=({symbolsPolicy:o,that:t,win:e,setupRef:n})=>{const{list:s}=n;b({that:t,symbolsPolicy:o,win:e,setupRef:n}),o.getListByKeywords().then(i=>{s.value=i,b({that:t,symbolsPolicy:o,win:e,setupRef:n})})},Pt=({symbolsPolicy:o,that:t,keywords:e,win:n,setupRef:s})=>{b({that:t,symbolsPolicy:o,win:n,setupRef:s});const{list:i}=s;o.getListByKeywords(e).then(r=>{i.value=r,b({that:t,symbolsPolicy:o,win:n,setupRef:s})})},Ot=({that:o,win:t,setupRef:e})=>{const n=y(o,"editorEle"),s=y(o,"dropdownEle");if(!n)return;const i=vt(n,t),r=ut({caret:i,dropdownEle:s,scrollingEle:t.document.scrollingElement}),{dropdownPos:l,isShowDropdown:a,activeIndex:c}=e;l.value={left:r.left+"px",top:r.top+"px"},c.value=0,a.value=!0},b=({that:o,symbolsPolicy:t,win:e,setupRef:n})=>{const{isShowDropdown:s,symbolsPolicy:i}=n;s.value=!1,i.value=null,T(()=>{Ot({that:o,win:e,setupRef:n}),i.value=t})},$=({html:o,selection:t,range:e,that:n,doc:s,setupRef:i})=>{if(e&&t){const r=s.createElement("div");let l=1;typeof o=="string"?(r.innerHTML=o,l=o.length):Array.isArray(o)?o.forEach(p=>{r.appendChild(p)}):r.appendChild(o);const a=s.createDocumentFragment();let c,d;for(;c=r.firstChild;)d=a.appendChild(c);e.insertNode(a),d&&(t.extend(d,l),t.collapseToEnd()),O({that:n,setupRef:i})}},Bt=(o,t)=>{let e;return t.clipboardData&&t.clipboardData.getData?e=t.clipboardData.getData("Text"):o.clipboardData&&o.clipboardData.getData&&(e=o.clipboardData.getData("text/plain")),e},Lt=({htmlDom:o,that:t,win:e,setupRef:n})=>{var i;const s=P(e);s&&o&&((i=s==null?void 0:s.range)==null||i.deleteContents(),$({html:o,selection:s.selection,range:s.range,that:t,doc:e.document,setupRef:n}))},O=({that:o,setupRef:t})=>{const e=Et(y(o,"editorEle")),{editorValue:n}=t;n.value=e},At=(o,t)=>{const e=[];return o.forEach(n=>{const{type:s,data:i}=n;if(s==="symbol"){const r=k(i,t);e.push(r)}else s==="br"?e.push(xt(t)):e.push(U(i,t))}),e},Nt=({e:o,that:t,win:e,setupRef:n})=>{const{isShowDropdown:s,activeIndex:i,list:r}=n;s.value&&(I(o)||K(o)?(I(o)&&mt(n),K(o)&&bt(i),m({e:o,setupRef:n})):yt(o)?(s.value=!1,m({e:o,setupRef:n}),W({data:r.value[i.value],that:t,doc:e.document,setupRef:n})):wt(o)&&(s.value=!1,m({e:o,setupRef:n})))},Ht=({e:o,that:t,win:e,props:n,setupRef:s})=>{const{preventKeyUp:i}=s;if(i.value){i.value=!1;return}i.value=!1;const r=St({e:o,props:n});r?G({symbolsPolicy:r,that:t,win:e,setupRef:s}):(J({that:t,win:e,props:n,setupRef:s}),T(()=>{O({that:t,setupRef:s})}))},J=({that:o,win:t,props:e,setupRef:n})=>{const s=P(t),i=Ct(s);if(i===null)return;const r=_t({props:e,str:i});if(r){const{getKeywords:l}=r,a=l(i);if(a?Pt({keywords:a,symbolsPolicy:r,that:o,win:t,setupRef:n}):G({symbolsPolicy:r,that:o,win:t,setupRef:n}),s){const{editorRange:c}=n;c.value=s}}q(n)},q=({list:o,isShowDropdown:t})=>{o.value=[],t.value=!1},It=({e:o,that:t,win:e,setupRef:n})=>{const s=Bt(o,e);return s&&Lt({htmlDom:s,that:t,win:e,setupRef:n}),o.preventDefault(),!1},Kt=({e:o,data:t,that:e,win:n,setupRef:s})=>{const{isShowDropdown:i}=s;i.value=!1,m({e:o,setupRef:s}),W({data:t,that:e,doc:n.document,setupRef:s})},zt=({win:o,setupRef:t})=>{const{isShowDropdown:e,editorRange:n}=t;e.value&&(n.value=P(o))},Mt=({that:o,doc:t,value:e,setupRef:n})=>{let s;const{length:i}=e||[];i&&(s=At(e,t));const{length:r}=s||[];if(r){const l=t.createElement("div");(s||[]).forEach(c=>{l.appendChild(c)});const a=y(o,"editorEle");a.innerHTML=l.innerHTML,O({that:o,setupRef:n})}},Vt=({symbol:o,regExp:t,watchInputEvent:e,getListByKeywords:n,watchStr:s,getKeywords:i})=>({symbol:o,regExp:t,watchStr:s||(a=>{const c=t.exec(a);return!!(c&&c.length>=2)}),getKeywords:i||(a=>{const[c,d]=t.exec(a)||[];return c===o?"":d}),watchInputEvent:e,getListByKeywords:n});const F={watchSymbolsPolicy:{type:Array,required:!0}};F.modelValue={type:Array,default:()=>[]};const j=M({name:"TextareaSymbol",props:F,setup(o,{emit:t}){const e=V(),n=h([]),s=h(0),i=h({top:"0",left:"0"}),r=h(!1),l=h([]),a=h(!1),c=h(null),d=h(null),p={list:n,activeIndex:s,dropdownPos:i,isShowDropdown:r,editorValue:l,preventKeyUp:a,symbolsPolicy:c,editorRange:d};H(()=>o.modelValue,u=>{JSON.stringify(u)!==JSON.stringify(l.value)&&T(()=>{Mt({value:u,doc:window.document,that:e,setupRef:p})})},{immediate:!0}),H(l,u=>{t("update:modelValue",u)});const S=u=>Ht({e:u,that:e,win:window,props:o,setupRef:p}),_=u=>Nt({e:u,that:e,win:window,setupRef:p}),C=()=>q(p),v=()=>J({that:e,win:window,props:o,setupRef:p}),x=u=>It({e:u,that:e,win:window,setupRef:p}),D=()=>console.log("\u6B63\u5728\u8F93\u5165\u4E2D\u6587"),X=()=>zt({win:window,setupRef:p}),Y=u=>{u.stopPropagation(),u.preventDefault()},Q=()=>f("div",{ref:"editorEle",class:"btp-textarea-symbol__editor",attrs:{contenteditable:!0},on:{keyup:S,keydown:_,blur:C,mouseup:v,paste:x,compositionstart:D,compositionend:X}}),Z=()=>n.value.map((u,tt)=>f("li",{key:u.id,class:["btp-dropdown__item",{active:s.value==tt}],on:{mousedown:et=>Kt({e:et,data:u,that:e,win:window,setupRef:p})}},[f(u.componentName||"span",u.componentProps||{},u.label)]));return()=>f("div",{ref:"symbolEditorEle",class:"btp-textarea-symbol"},[Q(),f("div",{ref:"dropdownEle",class:"btp-textarea-symbol__dropdown",style:[i.value,{visibility:r.value?"visible":"hidden"}],on:{mousedown:Y}},[f("div",{class:"btp-scrollbar"},[f("div",{class:"btp-scrollbar__wrap btp-dropdown__wrap"},[f("ul",{class:"btp-dropdown__list"},Z())])])])])}});j.initSymbolsPolicy=Vt;const Rt=j;var Gt=R(Rt,[["__scopeId","data-v-539dccae"]]);const kt=M({name:"BgVideo",props:{sources:{type:Array,required:!0},poster:{type:String,required:!0}},setup(o,t){const e=V(),n=h(!1),s=()=>{n.value=!0},i=()=>{console.log("checkPaly isPlaying.value",n.value),setTimeout(()=>{var r;if(console.log("checkPaly setTimeout isPlaying.value",n.value),!n.value){const l=(r=e==null?void 0:e.refs)==null?void 0:r.video;l==null||l.play(),i()}},3e3)};return rt(()=>{var l;const r=(l=e==null?void 0:e.refs)==null?void 0:l.video;r&&(r.removeEventListener("playing",s),r.addEventListener("playing",s)),i()}),()=>f("div",{class:"btp-bg-video"},[f("div",{style:{"z-index":1}},ct(t)),f("video",{ref:"video",style:{inset:"-100%"},attrs:{poster:o.poster,autoplay:!0,loop:"loop",muted:!0,preload:"auto","webkit-playsinline":!0,playsinline:"true","x-webkit-airplay":"allow","x5-video-player-type":"h5","x5-video-player-fullscreen":!0,"x5-video-orientation":"portraint"}},[o.sources.map(r=>f("source",{attrs:{src:r}}))])])}});var $t=R(kt,[["__scopeId","data-v-011692ca"]]);export{$t as B,Gt as T};
