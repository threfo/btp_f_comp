var Q=Object.defineProperty,Z=Object.defineProperties;var tt=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var L=(e,t,o)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,g=(e,t)=>{for(var o in t||(t={}))A.call(t,o)&&L(e,o,t[o]);if(S)for(var o of S(t))N.call(t,o)&&L(e,o,t[o]);return e},D=(e,t)=>Z(e,tt(t));var M=(e,t)=>{var o={};for(var n in e)A.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(e!=null&&S)for(var n of S(e))t.indexOf(n)<0&&N.call(e,n)&&(o[n]=e[n]);return o};import{h as et,t as z,n as T,d as R,M as V,x as f,E as K,y as ot}from"./plugin-vue_export-helper.494fd9a4.js";const nt=e=>e?Object.entries(e).reduce((t,[o,n])=>(o=o.charAt(0).toUpperCase()+o.slice(1),o=`on${o}`,D(g({},t),{[o]:n})),{}):null,$=(e,t={},o)=>{const d=t,{props:n,attrs:s,domProps:i,on:r}=d,l=M(d,["props","attrs","domProps","on"]),c=nt(r),a=g(g(g(g(g({},l),n),s),i),c);return et(e,a,o)},st=e=>typeof e=="function"?e():e;class it{constructor({caret:t,dropdownEle:o,scrollingEle:n,fixHeightGap:s=5}){this.fixHeightGap=5,this.fixHeightGap=s,this.initCaret(t),this.initClient(n),this.initDropdownSize(o)}initCaret(t){const{top:o,height:n}=t||{},{fixHeightGap:s}=this;this.caret=D(g({},t),{top:o-s,height:n+s+5})}initClient(t){const{caret:o}=this,{left:n,top:s}=o||{},{clientWidth:i,clientHeight:r}=t||{},l=s,c=i-n,a=r-l;this.client={clientWidth:i,clientHeight:r,toClientLeft:n,toClientTop:l,toClientRight:c,toClientBottom:a}}initDropdownSize(t){const{offsetHeight:o,offsetWidth:n}=t;this.dropdownSize={height:o,width:n}}get isBottom(){const{client:t,caret:o,dropdownSize:n}=this,{toClientBottom:s}=t;return s-o.height>=n.height}get isRight(){const{client:t,dropdownSize:o}=this,{toClientRight:n}=t;return n>=o.width}get isTop(){const{dropdownSize:t,client:o}=this,{toClientTop:n}=o;return n>=t.height}get isLeft(){const{dropdownSize:t,client:o}=this,{toClientLeft:n}=o;return n>=t.width}get isBottomRight(){return this.isBottom&&this.isRight}get isTopRight(){return this.isTop&&this.isRight}get isBottomLeft(){return this.isBottom&&this.isLeft}get isTopLeft(){return this.isTop&&this.isLeft}positionBottomRight(){const{client:t,caret:o}=this,{toClientTop:n,toClientLeft:s}=t;return{top:n+o.height,left:s}}positionTopRight(){const{dropdownSize:t,client:o}=this,{toClientTop:n,toClientLeft:s}=o;return{top:n-t.height,left:s}}positionBottomLeft(){const{dropdownSize:t,client:o,caret:n}=this,{toClientTop:s,toClientLeft:i}=o;return{top:s+n.height,left:i-t.width}}positionTopLeft(){const{dropdownSize:t,client:o}=this,{toClientTop:n,toClientLeft:s}=o;return{top:n-t.height,left:s-t.width}}positionOther(){const{dropdownSize:t,client:o}=this,{toClientTop:n,toClientLeft:s,toClientRight:i,toClientBottom:r,caret:l}=o,c=s>i?s-t.width:s;return{top:n>r?n-t.height:n+l.height,left:c}}get position(){return this.isBottomRight?this.positionBottomRight():this.isTopRight?this.positionTopRight():this.isBottomLeft?this.positionBottomLeft():this.isTopLeft?this.positionTopLeft():this.positionOther()}}const rt=({caret:e,dropdownEle:t,scrollingEle:o,fixHeightGap:n=5})=>new it({caret:e,dropdownEle:t,scrollingEle:o,fixHeightGap:n}).position,lt=e=>{let t=null,o;const{getSelection:n}=e||{};if(n){o=e.getSelection();const{rangeCount:s}=o||{};s>0&&(t=o.getRangeAt(0))}return t},ct=e=>{var r;const t=(r=e==null?void 0:e.createRange())==null?void 0:r.duplicate();t==null||t.moveStart("character",-1);const o=t==null?void 0:t.getBoundingClientRect(),{bottom:n=0,top:s=0,left:i=0}=o||{};return{height:n-s,left:i,top:s}},at=e=>{const t=e==null?void 0:e.cloneRange();t==null||t.setStart(e.endContainer,e.endOffset-1),t==null||t.setEnd(e.endContainer,e.endOffset);const o=t==null?void 0:t.getBoundingClientRect(),{height:n=0,top:s=0,left:i=0,width:r=0}=o||{},l={height:n,left:i+r,top:s};return t==null||t.detach(),l},dt=(e,t)=>{const o=e==null?void 0:e.cloneRange(),n=t==null?void 0:t.createTextNode("|");o==null||o.insertNode(n),o==null||o.selectNode(n);const s=o==null?void 0:o.getBoundingClientRect(),{height:i=0,left:r=0,top:l=0}=s||{},c={height:i,left:r,top:l};return n==null||n.remove(),o==null||o.detach(),c},ut=(e,t,o)=>{const{_initRange:n,_getDefOffset:s,_getHeight0Offset:i,_getOldIEOffset:r}=o||{_initRange:lt,_getDefOffset:at,_getHeight0Offset:dt,_getOldIEOffset:ct};let l;const c=n(t),{document:a}=t||{},{selection:d}=a||{};if(c){c.endOffset-1>0&&c.endContainer!==e&&(l=s(c));const{height:u=0}=l||{};u===0&&(l=i(c,a))}else d&&(l=r(d));return l&&(l.top+=t.pageYOffset,l.left+=t.pageXOffset),l},y=(e,t)=>{const{refs:o}=e||{};return(o||{})[t]},x=({e,setupRef:t})=>{const{preventKeyUp:o}=t;e.preventDefault(),o.value=!0},H=e=>e.code==="ArrowDown",I=e=>e.code==="ArrowUp",pt=e=>e.code==="Enter",ft=e=>e.code==="Escape",ht=e=>{const{activeIndex:t,list:o}=e;t.value++,t.value===o.value.length&&(t.value=o.value.length-1)},gt=e=>{e.value--,e.value===-1&&(e.value=0)},wt=({props:e,e:t})=>{const{watchSymbolsPolicy:o}=z(e||{});return o.value.find(s=>{const{watchInputEvent:i}=s||{};return i(t)})},yt=({str:e,props:t})=>{const{watchSymbolsPolicy:o}=z(t||{});return o.value.find(s=>{const{watchStr:i}=s||{};return i(e)})},vt=e=>{const{range:t,selection:o}=e||{},{endContainer:n}=t||{},{nodeName:s,textContent:i}=n||{},{focusOffset:r}=o||{};let l=null;return s==="#text"&&i&&(l=i.slice(0,r)),l},P=e=>{let t=null,o=null,n=null;return e.getSelection&&(n=e.getSelection(),n.getRangeAt&&n.rangeCount&&(o=n.getRangeAt(0),t={range:o,selection:n})),t},k=(e,t)=>{const{label:o,symbol:n}=e||{},s=t.createElement("button");return s.dataset.value=JSON.stringify(e),s.textContent=`${n||"@"}${o||""}`,s.contentEditable=!1,s.addEventListener("click",()=>!1,!1),s.tabindex="-1",s},U=(e,t)=>t.createTextNode(e),mt=e=>e.createElement("br"),bt=e=>U("\u200B",e),W=({data:e,that:t,doc:o,setupRef:n})=>{var c,a;const{isShowDropdown:s,editorRange:i,symbolsPolicy:r}=n;s.value=!1;const l=y(t,"editorEle");if(l){l.focus();const{range:d}=i.value||{};if(!d||!r.value)return;const{endContainer:u,endOffset:v}=d||{},{nodeValue:m}=u||{},{regExp:b}=r.value||{},w=b.exec(m);if(w&&w.length>1){d.setStart(u,w.index),d.setEnd(u,v),d.deleteContents();const C=k(e,o),h=bt(o);i.value&&J({html:[C,h],selection:(c=i.value)==null?void 0:c.selection,range:(a=i.value)==null?void 0:a.range,that:t,doc:o,setupRef:n})}}},Ct=e=>{let t=[];return e&&Array.from(e.childNodes).forEach(function(o){if(o.nodeName==="#text"){let n=o.nodeValue;n&&n.length>0&&n[n.length-1].charCodeAt(0)===8203&&(n=n.slice(0,-1)),n&&t.push({type:"text",data:n})}else o.nodeName==="BR"?t.push({type:"br",data:`
`}):o.nodeName==="BUTTON"?t.push({type:"symbol",data:JSON.parse(o.dataset.value)}):o.nodeName==="SPAN"&&t.push({type:"text",data:o.textContent})}),t=St(t),t},St=e=>{const t=[];return e.forEach(o=>{const n=t[t.length-1];n&&n.type&&n.type==="text"&&o.type==="text"?n.data=n.data+o.data:t.push(o)}),t},G=({symbolsPolicy:e,that:t,win:o,setupRef:n})=>{const{list:s}=n;E({that:t,symbolsPolicy:e,win:o,setupRef:n}),e.getListByKeywords().then(i=>{s.value=i,E({that:t,symbolsPolicy:e,win:o,setupRef:n})})},xt=({symbolsPolicy:e,that:t,keywords:o,win:n,setupRef:s})=>{E({that:t,symbolsPolicy:e,win:n,setupRef:s});const{list:i}=s;e.getListByKeywords(o).then(r=>{i.value=r,E({that:t,symbolsPolicy:e,win:n,setupRef:s})})},Et=({that:e,win:t,setupRef:o})=>{const n=y(e,"editorEle"),s=y(e,"dropdownEle");if(!n)return;const i=ut(n,t),r=rt({caret:i,dropdownEle:s,scrollingEle:t.document.scrollingElement}),{dropdownPos:l,isShowDropdown:c,activeIndex:a}=o;l.value={left:r.left+"px",top:r.top+"px"},a.value=0,c.value=!0},E=({that:e,symbolsPolicy:t,win:o,setupRef:n})=>{const{isShowDropdown:s,symbolsPolicy:i}=n;s.value=!1,i.value=null,T(()=>{Et({that:e,win:o,setupRef:n}),i.value=t})},J=({html:e,selection:t,range:o,that:n,doc:s,setupRef:i})=>{if(o&&t){const r=s.createElement("div");let l=1;typeof e=="string"?(r.innerHTML=e,l=e.length):Array.isArray(e)?e.forEach(u=>{r.appendChild(u)}):r.appendChild(e);const c=s.createDocumentFragment();let a,d;for(;a=r.firstChild;)d=c.appendChild(a);o.insertNode(c),d&&(t.extend(d,l),t.collapseToEnd()),_({that:n,setupRef:i})}},Dt=(e,t)=>{let o;return t.clipboardData&&t.clipboardData.getData?o=t.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData&&(o=e.clipboardData.getData("text/plain")),o},Tt=({htmlDom:e,that:t,win:o,setupRef:n})=>{var i;const s=P(o);s&&e&&((i=s==null?void 0:s.range)==null||i.deleteContents(),J({html:e,selection:s.selection,range:s.range,that:t,doc:o.document,setupRef:n}))},_=({that:e,setupRef:t})=>{const o=Ct(y(e,"editorEle")),{editorValue:n}=t;n.value=o},Pt=(e,t)=>{const o=[];return e.forEach(n=>{const{type:s,data:i}=n;if(s==="symbol"){const r=k(i,t);o.push(r)}else s==="br"?o.push(mt(t)):o.push(U(i,t))}),o},_t=({e,that:t,win:o,setupRef:n})=>{const{isShowDropdown:s,activeIndex:i,list:r}=n;s.value&&(H(e)||I(e)?(H(e)&&ht(n),I(e)&&gt(i),x({e,setupRef:n})):pt(e)?(s.value=!1,x({e,setupRef:n}),W({data:r.value[i.value],that:t,doc:o.document,setupRef:n})):ft(e)&&(s.value=!1,x({e,setupRef:n})))},Ot=({e,that:t,win:o,props:n,setupRef:s})=>{const{preventKeyUp:i}=s;if(i.value){i.value=!1;return}i.value=!1;const r=wt({e,props:n});r?G({symbolsPolicy:r,that:t,win:o,setupRef:s}):(q({that:t,win:o,props:n,setupRef:s}),T(()=>{_({that:t,setupRef:s})}))},q=({that:e,win:t,props:o,setupRef:n})=>{const s=P(t),i=vt(s);if(i===null)return;const r=yt({props:o,str:i});if(r){const{getKeywords:l}=r,c=l(i);if(c?xt({keywords:c,symbolsPolicy:r,that:e,win:t,setupRef:n}):G({symbolsPolicy:r,that:e,win:t,setupRef:n}),s){const{editorRange:a}=n;a.value=s}}F(n)},F=({list:e,isShowDropdown:t})=>{e.value=[],t.value=!1},Bt=({e,that:t,win:o,setupRef:n})=>{const s=Dt(e,o);return s&&Tt({htmlDom:s,that:t,win:o,setupRef:n}),e.preventDefault(),!1},Lt=({e,data:t,that:o,win:n,setupRef:s})=>{const{isShowDropdown:i}=s;i.value=!1,x({e,setupRef:s}),W({data:t,that:o,doc:n.document,setupRef:s})},At=({win:e,setupRef:t})=>{const{isShowDropdown:o,editorRange:n}=t;o.value&&(n.value=P(e))},Nt=({that:e,doc:t,value:o,setupRef:n})=>{let s;const{length:i}=o||[];i&&(s=Pt(o,t));const{length:r}=s||[];if(r){const l=t.createElement("div");(s||[]).forEach(a=>{l.appendChild(a)});const c=y(e,"editorEle");c.innerHTML=l.innerHTML,_({that:e,setupRef:n})}},Mt=({symbol:e,regExp:t,watchInputEvent:o,getListByKeywords:n,watchStr:s,getKeywords:i})=>({symbol:e,regExp:t,watchStr:s||(c=>{const a=t.exec(c);return!!(a&&a.length>=2)}),getKeywords:i||(c=>{const[a,d]=t.exec(c)||[];return a===e?"":d}),watchInputEvent:o,getListByKeywords:n});const j={watchSymbolsPolicy:{type:Array,required:!0}};j.modelValue={type:Array,default:()=>[]};const X=R({name:"TextareaSymbol",props:j,setup(e,{emit:t}){const o=V(),n=f([]),s=f(0),i=f({top:"0",left:"0"}),r=f(!1),l=f([]),c=f(!1),a=f(null),d=f(null),u={list:n,activeIndex:s,dropdownPos:i,isShowDropdown:r,editorValue:l,preventKeyUp:c,symbolsPolicy:a,editorRange:d};return K(()=>e.modelValue,p=>{JSON.stringify(p)!==JSON.stringify(l.value)&&T(()=>{Nt({value:p,doc:window.document,that:o,setupRef:u})})},{immediate:!0}),K(l,p=>{t("update:modelValue",p)}),{stopPreventMousedown:p=>{p.stopPropagation(),p.preventDefault()},compositionend:()=>At({win:window,setupRef:u}),onCompositionstart:()=>console.log("\u6B63\u5728\u8F93\u5165\u4E2D\u6587"),onPaste:p=>Bt({e:p,that:o,win:window,setupRef:u}),onMouseup:()=>q({that:o,win:window,props:e,setupRef:u}),onBlur:()=>F(u),onKeydown:p=>_t({e:p,that:o,win:window,setupRef:u}),onKeyup:p=>Ot({e:p,that:o,win:window,props:e,setupRef:u}),liMousedown:(p,Y)=>Lt({e:p,data:Y,that:o,win:window,setupRef:u}),dropdownPos:i,isShowDropdown:r,list:n,activeIndex:s}},render(e){const t=$,{stopPreventMousedown:o,compositionend:n,onCompositionstart:s,onPaste:i,onMouseup:r,onBlur:l,onKeydown:c,onKeyup:a,liMousedown:d,dropdownPos:u,isShowDropdown:v,list:m,activeIndex:b}=this,w=()=>t("div",{ref:"editorEle",class:"btp-textarea-symbol__editor",attrs:{contenteditable:!0},on:{keyup:a,keydown:c,blur:l,mouseup:r,paste:i,compositionstart:s,compositionend:n}}),C=()=>m.map((h,O)=>t("li",{key:h.id,class:["btp-dropdown__item",{active:b==O}],on:{mousedown:B=>d(B,h)}},[t(h.componentName||"span",h.componentProps||{},h.label)]));return t("div",{ref:"symbolEditorEle",class:"btp-textarea-symbol"},[w(),t("div",{ref:"dropdownEle",class:"btp-textarea-symbol__dropdown",style:[u,{display:v?"block":"none"}],on:{mousedown:o}},[t("div",{class:"btp-scrollbar"},[t("div",{class:"btp-scrollbar__wrap btp-dropdown__wrap"},[t("ul",{class:"btp-dropdown__list"},C())])])])])}});X.initSymbolsPolicy=Mt;const zt=X;const Rt=R({name:"BgVideo",props:{sources:{type:Array,required:!0},poster:{type:String,required:!0}},setup(){const e=V(),t=f(!1),o=()=>{t.value=!0},n=()=>{console.log("checkPaly isPlaying.value",t.value),setTimeout(()=>{var s;if(console.log("checkPaly setTimeout isPlaying.value",t.value),!t.value){const i=(s=e==null?void 0:e.refs)==null?void 0:s.video;i==null||i.play(),n()}},3e3)};return ot(()=>{var i;const s=(i=e==null?void 0:e.refs)==null?void 0:i.video;s&&(s.removeEventListener("playing",o),s.addEventListener("playing",o)),n()}),{}},render(e){const t=this.$slots.default?st(this.$slots.default):[],{poster:o,sources:n}=this,s=$;return s("div",{class:"btp-bg-video"},[s("div",{style:{"z-index":1}},t||[]),s("video",{ref:"video",style:{inset:"-100%"},attrs:{poster:o,autoplay:!0,loop:"loop",muted:!0,preload:"auto","webkit-playsinline":!0,playsinline:"true","x-webkit-airplay":"allow","x5-video-player-type":"h5","x5-video-player-fullscreen":!0,"x5-video-orientation":"portraint"}},[n.map(i=>s("source",{attrs:{src:i}}))])])}});export{zt as _,Rt as a};
